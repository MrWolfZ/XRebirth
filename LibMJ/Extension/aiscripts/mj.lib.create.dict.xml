<?xml version="1.0" encoding="utf-8" ?>
<!-- 
	This file is part of the X Rebirth LibMJ script library.
	
	Author: MadJoker
  
  Last Change:
	Version: V0.0.1
	Date: 20th Apr 2014
  
  X Rebirth version: 1.30
-->

<!--
  This script is used to create dictionaries for the calling entity.
-->
<aiscript name="mj.lib.create.dict" version="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../Resources/aiscripts.xsd">
  <actions>
    <!-- We create a signal for our special dictionary factory cue -->
    <signal_objects object="player.primaryship" param="'LibMJ_CreateDictionary'" param2="this" />

    <set_value name="$dDict" exact="null" />
    
    <!-- 
      Since we do not know whether the cue is executed synchronously (which it 
      most likely is not), we need to do a loop wait until the result is set.
      Note that a solution with wait/interrupt via signalling doesn't work, since
      the resulting signal might occur before we enter the wait, which will lead to
      a deadlock.
    -->
    <do_while value="not this.$dLibMJ_CreateDictionaryResult?">
      <wait exact="10ms" />
    </do_while>
    
    <!-- At this point we should have our dictionary -->
    <set_value name="$dDict" exact="this.$dLibMJ_CreateDictionaryResult" />
    <remove_value name="this.$dLibMJ_CreateDictionaryResult" />

    <!-- Lastly we return the result -->
    <return value="$dDict" />
  </actions>
</aiscript>