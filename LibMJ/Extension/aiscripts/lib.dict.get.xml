<?xml version="1.0" encoding="utf-8" ?>
<!-- 
	This file is part of the X Rebirth UFO mod.
	
	Author: MadJoker
  
  Last Change:
	Version: V0.4.3 Beta
	Date: 29th Dec 2013
  
  X Rebirth version: 1.21
-->

<!--
  This script is part of a set of utility scripts to handle associative arrays (aka dictionaries).
  
  Dictionaries are represented as an array containing two lists of matching size, e.g. [['key1','key2'],['value1','value2']].

  Returns the value for the given key from the given dictionary.
-->
<aiscript name="lib.dict.get" version="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../Resources/aiscripts.xsd">
  <params>
    <param name="dDict" default="[[],[]]" />
    <param name="oKey" />
  </params>
  <actions>
    <!-- Sanity check for valid dictionary -->
    <do_if value="$dDict.count != 2">
      <debug_text filter="error" text="'The given dictionary %1 does not have the right size. Expected size: 2 (keys and values), Actual size: %2'.[$dDict,$dDict.count]" />
      <return value="$dDict" />
    </do_if>
    
    <!-- First, we extract the given dictionary -->
    <set_value name="$lKeys" exact="$dDict.{1}" />
    <set_value name="$lValues" exact="$dDict.{2}" />

    <!-- Sanity check for matching key and value list sizes -->
    <do_if value="$lKeys.count != $lValues.count">
      <debug_text filter="error" text="'The key and value lists of the given dictionary %1 do not match in size. Key count: %2, Value count: %3'.[$dDict,$lKeys.count,$lValues.count]" />
      <return value="$dDict" />
    </do_if>
    
    <!-- We find the key index -->
    <set_value name="$iKeyIdx" exact="$lKeys.indexof.{$oKey}" />

    <!-- If the key exists, we return the value -->
    <do_if value="$iKeyIdx gt 0">
      <return value="$lValues.{$iKeyIdx}" />
    </do_if>

    <!-- Otherwise, we return null -->
    <do_else>
      <return value="null" />
    </do_else>

    <!-- 
      On a sidenote, this script can be written in one line:
      
      <return value="@$dDict.{2}.{$dDict.{1}.indexof.{$oKey}}" />
      
      However, I encourage you to always try to write your code as easy
      to read as possible.
    -->
  </actions>
</aiscript>